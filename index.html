<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=390, initial-scale=1.0" />
  <title>NFT Minter</title>

  <!-- Farcaster Mini App Metadata -->
  <meta name="fc:miniapp" content='{
    "version":"1",
    "imageUrl":"https://nft-arb-base-miniapp.vercel.app/image.png",
    "button":{
      "title":"ONCHAIN YOUR MEMORY",
      "action":{
        "type":"launch_frame",
        "name":"Snapshot",
        "url":"https://nft-arb-base-miniapp.vercel.app",
        "splashImageUrl":"https://nft-arb-base-miniapp.vercel.app/icon.png",
        "splashBackgroundColor":"#2c67f2"
      }
    }
  }' />

  <style>
   * { box-sizing: border-box; }
body {
  margin: 0;
  background: #000000;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  max-width: 390px;
  margin-inline: auto;
  padding: 20px;
  transition: background 0.3s ease, color 0.3s ease;
}

body.light-mode {
  background: linear-gradient(135deg, #a8b5ff 0%, #c9a8e8 100%);
  color: #1a1a1a;
}

  .theme-toggle {
  position: fixed;
  top: 25px;
  right: 25px;
  width: 30px;
  height: 30px;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(10px);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all 0.3s ease;
  z-index: 1000;
}

.theme-toggle:hover {
  transform: scale(1.1);
  background: rgba(255, 255, 255, 0.25);
}

body.light-mode .theme-toggle {
  background: rgba(0, 0, 0, 0.1);
}

body.light-mode .theme-toggle:hover {
  background: rgba(0, 0, 0, 0.15);
}
    .container {
      width: 100%;
      max-width: 360px;
    }

    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .subtitle {
      text-align: center;
      opacity: 0.9;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .upload-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      border: 2px dashed rgba(255, 255, 255, 0.3);
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    body.light-mode .upload-section {
      background: rgba(255, 255, 255, 0.4);
      border-color: rgba(0, 0, 0, 0.2);
    }

    .upload-section.dragover {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }

    .upload-section.has-image {
      border-style: solid;
      border-color: #4ade80;
    }

    #imagePreview {
      max-width: 100%;
      max-height: 160px;
      border-radius: 12px;
      display: none;
    }

    #imagePreview.show {
      display: block;
    }

    .upload-icon {
      font-size: 40px;
      margin-bottom: 8px;
    }

    .upload-text {
      font-size: 15px;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .upload-hint {
      font-size: 12px;
      opacity: 0.7;
    }

    .nft-name-input {
      width: 100%;
      padding: 14px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      margin-bottom: 16px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    body.light-mode .nft-name-input {
      background: rgba(255, 255, 255, 0.6);
      border-color: rgba(0, 0, 0, 0.2);
      color: #1a1a1a;
    }

    .nft-name-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    body.light-mode .nft-name-input::placeholder {
      color: rgba(0, 0, 0, 0.5);
    }

    .nft-name-input:focus {
      border-color: #4ade80;
    }

    .chain-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .chain-btn {
      flex: 1;
      padding: 14px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      border-radius: 12px;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    body.light-mode .chain-btn {
      background: rgba(255, 255, 255, 0.4);
      border-color: rgba(0, 0, 0, 0.2);
      color: #1a1a1a;
    }

    .chain-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    .chain-btn.selected {
      background: rgba(255, 255, 255, 0.25);
      border-color: #4ade80;
      box-shadow: 0 0 20px rgba(74, 222, 128, 0.4);
    }

    .mint-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      color: #000;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      font-size: 17px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(74, 222, 128, 0.4);
    }

    .mint-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(74, 222, 128, 0.6);
    }

    .mint-btn:disabled {
      background: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
      box-shadow: none;
    }

    .share-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      font-size: 17px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
      margin-top: 12px;
      display: none;
    }

    .share-btn.show {
      display: block;
    }

    .share-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.6);
    }

    .share-btn:disabled {
      background: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
      box-shadow: none;
    }

    .status {
      text-align: center;
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
    }

    .status.show {
      display: block;
    }

    .status.loading {
      background: rgba(59, 130, 246, 0.2);
      border: 1px solid rgba(59, 130, 246, 0.4);
    }

    .status.success {
      background: rgba(74, 222, 128, 0.2);
      border: 1px solid rgba(74, 222, 128, 0.4);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
    }

    .status a {
      color: #4ade80;
      text-decoration: underline;
      font-weight: 600;
    }

    .loader {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top: 3px solid #fff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .warning-box {
      background: rgba(239, 68, 68, 0.15);
      border: 2px solid rgba(239, 68, 68, 0.4);
      border-radius: 12px;
      padding: 10px 12px;
      margin-bottom: 16px;
      font-size: 13px;
      line-height: 1.4;
      display: flex;
      align-items: flex-start;
      gap: 8px;
    }

    .warning-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .header {
      text-align: center;
      margin-bottom: 16px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .creator-tag {
      font-size: 14px;
      opacity: 0.8;
      font-weight: 600;
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 13px;
    }

    .footer a {
      color: #4ade80;
      text-decoration: none;
      font-weight: 700;
      transition: opacity 0.3s ease;
    }

    .footer a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    .change-image-btn {
      margin-top: 10px;
      padding: 7px 14px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .change-image-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    body.light-mode .change-image-btn {
      background: rgba(0, 0, 0, 0.1);
      border-color: rgba(0, 0, 0, 0.2);
      color: #1a1a1a;
    }

    body.light-mode .change-image-btn:hover {
      background: rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">üåô</button>
  
  <div class="container">
    <div class="header">
      <h1>Snapshot</h1>
      <div class="creator-tag">
  by <a href="https://farcaster.xyz/oce3n" target="_blank">@oce3n</a>
</div>

    </div>

    <div class="warning-box">
      <div class="warning-icon">‚ö†Ô∏è</div>
      <div>
        <strong>Important:</strong> Don't upload already existing NFT collection images! Only mint your own original content.
      </div>
    </div>

    <div class="upload-section" id="uploadSection">
      <div id="uploadPrompt">
        <div class="upload-icon">üì∏</div>
        <div class="upload-text">Drag & Drop Image Here</div>
        <div class="upload-hint">or paste from clipboard</div>
        <button class="change-image-btn" id="chooseFileBtn" style="display:block; margin-top:12px;">Choose from Gallery</button>
      </div>
      <img id="imagePreview" alt="Preview" />
      <button class="change-image-btn" id="changeImageBtn" style="display:none;">Change Image</button>
      <input type="file" id="fileInput" accept="image/*" style="display:none;" />
    </div>

    <input 
      type="text" 
      id="nftName" 
      class="nft-name-input" 
      placeholder="NFT Name (optional)"
    />

    <div class="chain-selector">
      <button class="chain-btn" id="arbBtn" data-chain="arbitrum">
        <img src="arb.png" alt="Arbitrum" style="width: 40px; height: 40px; object-fit: contain;">
        <div>Arbitrum</div>
      </button>
      <button class="chain-btn" id="baseBtn" data-chain="base">
        <img src="base.png" alt="Base" style="width: 40px; height: 40px; object-fit: contain;">
        <div>Base</div>
      </button>
    </div>

    <button class="mint-btn" id="mintBtn" disabled>
      Select Image & Chain to Mint
    </button>

    <button class="share-btn" id="shareBtn">
      üéâ Share Your NFT on Farcaster
    </button>

    <div class="status" id="status"></div>

    <div class="footer">
      Follow Dev: <a href="https://farcaster.xyz/oce3n" target="_blank">@oce3n</a>
    </div>
  </div>

  <script type="module">
    import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';
    
    import {
      createConfig, connect, switchChain, writeContract, getAccount, http
    } from 'https://esm.sh/@wagmi/core';
    import { arbitrum, base } from 'https://esm.sh/@wagmi/core/chains';
    import { farcasterMiniApp } from 'https://esm.sh/@farcaster/miniapp-wagmi-connector';

    const CONTRACTS = {
      base: '0x23Bbf3b4782A9Feac435F811b91E58BBcF7cC774',
      arbitrum: '0x4CFEFB86cb8Aa8dB67b9b2A8083647e4480f086d'
    };

    const NFT_ABI = [
      {
        "inputs": [{"internalType": "string", "name": "tokenURI_", "type": "string"}],
        "name": "mint",
        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
        "stateMutability": "payable",
        "type": "function"
      }
    ];

    const PINATA_JWT = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI4MTIzZjk3ZC1kMjA0LTQwYTctYTQ2Yy1iMTQzOTUzZDY4OWEiLCJlbWFpbCI6ImFpYnM4ODhAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBpbl9wb2xpY3kiOnsicmVnaW9ucyI6W3siZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiRlJBMSJ9LHsiZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiTllDMSJ9XSwidmVyc2lvbiI6MX0sIm1mYV9lbmFibGVkIjpmYWxzZSwic3RhdHVzIjoiQUNUSVZFIn0sImF1dGhlbnRpY2F0aW9uVHlwZSI6InNjb3BlZEtleSIsInNjb3BlZEtleUtleSI6ImZlZTkzZTk4YzdiOWJkZmM2M2ViIiwic2NvcGVkS2V5U2VjcmV0IjoiYzA2ZmM1Y2IzYWQ2YTg5NDQ2Yjg0M2E5MTU1YTRjMGM5ODk5MDVkMmVhNzFjOTA4NmQ3ZTYzYmJkMDU3YmNiMyIsImV4cCI6MTc5MTI2MzY0NX0.Ccavx6QYvvpPWOgiky9l-WfBNYm6uJCTh514tto242Q';

    const config = createConfig({
      chains: [arbitrum, base],
      transports: { [arbitrum.id]: http(), [base.id]: http() }
    });

    const uploadSection = document.getElementById('uploadSection');
    const uploadPrompt = document.getElementById('uploadPrompt');
    const imagePreview = document.getElementById('imagePreview');
    const changeImageBtn = document.getElementById('changeImageBtn');
    const chooseFileBtn = document.getElementById('chooseFileBtn');
    const fileInput = document.getElementById('fileInput');
    const nftNameInput = document.getElementById('nftName');
    const baseBtn = document.getElementById('baseBtn');
    const arbBtn = document.getElementById('arbBtn');
    const mintBtn = document.getElementById('mintBtn');
    const shareBtn = document.getElementById('shareBtn');
    const statusDiv = document.getElementById('status');

    let selectedFile = null;
    let selectedChain = null;
    let mintedNFTData = null;
    let isConnected = false;

    // Theme toggle functionality
    const themeToggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'dark';
    
    if (savedTheme === 'light') {
      document.body.classList.add('light-mode');
      themeToggle.textContent = '‚òÄÔ∏è';
    }

    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      const isLight = document.body.classList.contains('light-mode');
      themeToggle.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    });

    function showStatus(message, type) {
      statusDiv.innerHTML = message;
      statusDiv.className = `status show ${type}`;
    }

    function hideStatus() {
      statusDiv.classList.remove('show');
    }

    console.log('Initializing Farcaster SDK...');
    
   sdk.actions.ready({ disableNativeGestures: true })
  .then(async () => {
    console.log("Farcaster MiniApp SDK ready!");
    showStatus('App ready! Connecting wallet...', 'success');
    
    try {
      await connect(config, {
        connector: farcasterMiniApp(),
        chainId: arbitrum.id
      });
      
      const account = getAccount(config);
      if (account?.address) {
        isConnected = true;
        console.log('Wallet connected:', account.address);
        showStatus(`Connected: ${account.address.slice(0, 6)}...${account.address.slice(-4)}`, 'success');
        setTimeout(() => hideStatus(), 3000);
      } else {
        showStatus('Wallet connection incomplete', 'error');
      }

    } catch (err) {
      console.error('Wallet connection failed:', err);
      showStatus('Wallet connection failed. Please try again.', 'error');
    }

    // Auto-prompt to add app RIGHT AFTER splash screen closes
    const hasPromptedAddApp = sessionStorage.getItem('hasPromptedAddApp');
    if (!hasPromptedAddApp) {
      try {
        console.log('Auto-prompting add app...');
        await sdk.actions.addMiniApp();
        sessionStorage.setItem('hasPromptedAddApp', 'true');
        console.log('App added successfully!');
      } catch (error) {
        console.log('Add app prompt dismissed or failed:', error.name);
        sessionStorage.setItem('hasPromptedAddApp', 'true');
      }
    }

  })
  .catch(err => {
    console.error("SDK initialization failed:", err);
    showStatus('Failed to initialize. Please reopen in Warpcast.', 'error');
  });
      

    chooseFileBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      const files = e.target.files;
      if (files.length > 0) {
        handleFiles(files);
      }
    });

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      uploadSection.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      uploadSection.addEventListener(eventName, () => {
        uploadSection.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(eventName => {
      uploadSection.addEventListener(eventName, () => {
        uploadSection.classList.remove('dragover');
      });
    });

    uploadSection.addEventListener('drop', (e) => {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    });

    document.addEventListener('paste', (e) => {
      const items = e.clipboardData?.items;
      if (!items) return;

      for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('image') !== -1) {
          const blob = items[i].getAsFile();
          handleFiles([blob]);
          break;
        }
      }
    });

    changeImageBtn.addEventListener('click', () => {
      selectedFile = null;
      imagePreview.classList.remove('show');
      uploadPrompt.style.display = 'block';
      changeImageBtn.style.display = 'none';
      uploadSection.classList.remove('has-image');
      updateMintButton();
    });

    function handleFiles(files) {
      if (files.length === 0) return;
      
      const file = files[0];
      if (!file.type.startsWith('image/')) {
        showStatus('Please upload an image file', 'error');
        return;
      }

      selectedFile = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.src = e.target.result;
        imagePreview.classList.add('show');
        uploadPrompt.style.display = 'none';
        changeImageBtn.style.display = 'block';
        uploadSection.classList.add('has-image');
        updateMintButton();
      };
      reader.readAsDataURL(file);
    }

    baseBtn.addEventListener('click', () => {
      selectedChain = 'base';
      baseBtn.classList.add('selected');
      arbBtn.classList.remove('selected');
      updateMintButton();
    });

    arbBtn.addEventListener('click', () => {
      selectedChain = 'arbitrum';
      arbBtn.classList.add('selected');
      baseBtn.classList.remove('selected');
      updateMintButton();
    });

    function updateMintButton() {
      if (selectedFile && selectedChain) {
        mintBtn.disabled = false;
        mintBtn.textContent = `Mint on ${selectedChain === 'base' ? 'Base' : 'Arbitrum'} (FREE)`;
      } else {
        mintBtn.disabled = true;
        mintBtn.textContent = 'Select Image & Chain to Mint';
      }
    }

    async function uploadToPinata(file, metadata) {
      try {
        showStatus('<span class="loader"></span>Uploading image to IPFS...', 'loading');
        
        const formData = new FormData();
        formData.append('file', file);
        
        const imageResponse = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${PINATA_JWT}`
          },
          body: formData
        });

        if (!imageResponse.ok) {
          const errorData = await imageResponse.json().catch(() => ({}));
          throw new Error(errorData.error?.details || 'Failed to upload image');
        }

        const imageData = await imageResponse.json();
        const imageIpfsHash = imageData.IpfsHash;

        showStatus('<span class="loader"></span>Creating metadata...', 'loading');
        
        const nftMetadata = {
          name: metadata.name || 'My NFT',
          description: metadata.description || 'Minted via Farcaster Mini App',
          image: `ipfs://${imageIpfsHash}`,
          attributes: [
            { trait_type: 'Chain', value: selectedChain === 'base' ? 'Base' : 'Arbitrum' },
            { trait_type: 'Minted Via', value: 'Farcaster Mini App' }
          ]
        };

        const metadataResponse = await fetch('https://api.pinata.cloud/pinning/pinJSONToIPFS', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${PINATA_JWT}`
          },
          body: JSON.stringify({
            pinataContent: nftMetadata,
            pinataMetadata: {
              name: `${metadata.name || 'NFT'}_metadata.json`
            }
          })
        });

        if (!metadataResponse.ok) {
          const errorData = await metadataResponse.json().catch(() => ({}));
          throw new Error(errorData.error?.details || 'Failed to upload metadata');
        }

        const metadataData = await metadataResponse.json();
        
        return {
          tokenURI: `ipfs://${metadataData.IpfsHash}`,
          imageHash: imageIpfsHash,
          imageUrl: `https://gateway.pinata.cloud/ipfs/${imageIpfsHash}`
        };
      } catch (error) {
        console.error('Pinata upload error:', error);
        throw error;
      }
    }

  shareBtn.addEventListener('click', async () => {
      if (!mintedNFTData) return;

      try {
        shareBtn.disabled = true;
        showStatus('<span class="loader"></span>Opening cast composer...', 'loading');

        const { nftName, openSeaUrl, imageUrl, chain } = mintedNFTData;

        await sdk.actions.composeCast({
          text: `Just minted "${nftName}" on ${chain}! üé®‚ú®

Immortalize your memories onchain forever. Create yours üëá
Built by @oce3n`,
          embeds: [imageUrl, "https://nft-arb-base-miniapp.vercel.app"]
        });

        showStatus('Cast composer opened!', 'success');
        setTimeout(() => hideStatus(), 3000);
      } catch (error) {
        console.error('Share error:', error);
        showStatus('Failed to open cast composer', 'error');
      } finally {
        shareBtn.disabled = false;
      }
    });
    
    mintBtn.addEventListener('click', async () => {
      if (!selectedFile || !selectedChain) return;

      hideStatus();
      shareBtn.classList.remove('show');
      mintBtn.disabled = true;

      try {
        if (PINATA_JWT === 'YOUR_PINATA_JWT_HERE') {
          showStatus('Please configure your Pinata JWT token in the code', 'error');
          mintBtn.disabled = false;
          return;
        }

        const uploadResult = await uploadToPinata(selectedFile, {
          name: nftNameInput.value.trim() || 'My NFT',
          description: `Minted on ${selectedChain === 'base' ? 'Base' : 'Arbitrum'}`
        });

        showStatus('<span class="loader"></span>Switching network...', 'loading');
        const chainId = selectedChain === 'base' ? base.id : arbitrum.id;
        await switchChain(config, { chainId });

        showStatus('<span class="loader"></span>Minting your NFT...', 'loading');
        const txHash = await writeContract(config, {
          address: CONTRACTS[selectedChain],
          abi: NFT_ABI,
          functionName: 'mint',
          args: [uploadResult.tokenURI]
        });

        const userAccount = getAccount(config);
        const userAddress = userAccount?.address;

        const openSeaUrl = selectedChain === 'base' 
          ? `https://opensea.io/${userAddress}?tab=collected`
          : `https://opensea.io/${userAddress}?tab=collected&chain=arbitrum`;

        const explorerUrl = selectedChain === 'base' 
          ? `https://basescan.org/tx/${txHash}`
          : `https://arbiscan.io/tx/${txHash}`;

        mintedNFTData = {
          nftName: nftNameInput.value.trim() || 'My NFT',
          openSeaUrl: openSeaUrl,
          imageUrl: uploadResult.imageUrl,
          chain: selectedChain === 'base' ? 'Base' : 'Arbitrum'
        };

        showStatus(
          `üéâ NFT Minted Successfully!<br><a href="${openSeaUrl}" target="_blank">View on OpenSea</a> | <a href="${explorerUrl}" target="_blank">Transaction</a>`,
          'success'
        );

        shareBtn.classList.add('show');

        setTimeout(() => {
          selectedFile = null;
          selectedChain = null;
          nftNameInput.value = '';
          imagePreview.classList.remove('show');
          uploadPrompt.style.display = 'block';
          changeImageBtn.style.display = 'none';
          uploadSection.classList.remove('has-image');
          baseBtn.classList.remove('selected');
          arbBtn.classList.remove('selected');
          updateMintButton();
        }, 10000);

      } catch (error) {
        console.error('Minting error:', error);
        let errorMsg = 'Failed to mint NFT';
        if (error.message.includes('User rejected')) {
          errorMsg = 'Transaction rejected by user';
        } else if (error.message) {
          errorMsg = error.message;
        }
        showStatus(`Error: ${errorMsg}`, 'error');
        updateMintButton();
      }
    });
  </script>
</body>
</html>